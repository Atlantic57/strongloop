#!/usr/bin/env node

/**
 * Module dependencies.
 */
 
var program = require('commander');

/**
 * Commands
 */

var COMMANDS = {
    // 'build'             :   'compile a standalone version of your app',
    // 'clean'             :   'remove any built files',
    // 'doc'               :   'run dox on source files',
    'env'               :   'print node environment information',
    // 'lint'              :   'run jshint on source files',
    'install <module>'  :   'install packages and dependencies',
    // 'list'              :   'list available node packages',
    'run'               :   'run a specified script',
    'test'              :   'run tests',
    'version'           :   'print node version',
    'debug'             :   'run the debugger',
    // 'publish'           :   'publish "." or the given dir/tarball',
    'create <name>'     :   'scaffold projects and modules',
    '*'                 :   'run a script'
};

Object.keys(COMMANDS).forEach(function (cmd) {
  var file = cmd.split(' ')[0];
  
  if(file === '*') file = 'run';
  
  var module = require('../lib/' + file);
  
  if(typeof module !== 'function') return;
  
  program
    .command(cmd)
    .description(COMMANDS[cmd])
    .action(module(program, done));

  function done(err) {
    if(err) {
      console.log('failed to %s', cmd);
      console.error(err);
    }
  
    process.exit(1);
  }
});

program.parse(process.argv);
